{% extends 'base.html' %}

{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <div class="card shadow-lg">
                <div class="card-body text-center">

                    <h3 class="mb-3">Complete Your Payment</h3>

                    <p class="text-muted">
                        Amount to pay:
                        <strong>â‚¹ {{ amount }}</strong>
                    </p>

                    <button id="rzp-button"
                            class="btn btn-success btn-lg w-100 mt-3">
                        Pay Now
                    </button>

                    <p class="text-muted mt-3 small">
                        Secure payment powered by Razorpay
                    </p>

                </div>
            </div>

        </div>
    </div>
</div>

<!-- Razorpay Checkout Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {

    var payButton = document.getElementById("rzp-button");

    if (!payButton) {
        return;
    }

    payButton.onclick = function (e) {
        e.preventDefault();

        var options = {
            key: "{{ razorpay_key }}",
            amount: "{{ order.amount }}",   // amount in paise (already from Razorpay)
            currency: "INR",
            name: "Smart Shop",
            description: "Order Payment",
            order_id: "{{ order.id }}",
            handler: function (response) {
                // Redirect after successful payment
                window.location.href = "{% url 'store:payment_success' %}";
            },
            prefill: {
                name: "{{ request.user.username }}",
                email: "{{ request.user.email }}"
            },
            theme: {
                color: "#198754"
            }
        };

        var rzp = new Razorpay(options);
        rzp.open();
    };

});
</script>
{% endblock %}
